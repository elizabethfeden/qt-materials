# Инструкция по Qt Linguist

[Ссылка на официальную документацию](
https://doc.qt.io/qt-6/linguist-manager.html).

Credit: [@anevero](https://github.com/anevero)

## Этапы перевода приложения

Перевод приложения на Qt на другие языки состоит из нескольких этапов:

1. Оборачивание всех строк внутри вашего исходного кода в конструкцию `tr()`.
2. Генерация служебных файлов Qt Linguist, в которых будет храниться 
информация о переводах, и которые вы с помощью этой утилиты будете 
редактировать. Они имеют расширение `.ts`.
3. Перевод приложения с помощью Qt Linguist, сохранение результатов в
сгенерированных ранее файлах.
4. Компиляция `.ts`-файлов (перевод их в бинарный формат). В итоге получатся
файлы с расширением `.qm`.
5. Добавление `.qm`-файлов в ресурсы приложения.
6. Настройка активации языка в вашем исходном коде.
7. Компиляция и работа с приложением.

### 0. Подготовка

Для начала нужно найти приложение Qt Linguist и консольные утилиты `lrelease` и `lupdate`. И настроить систему так, чтобы их можно было вызывать из командной строки.

Если у вас Windows, то все уже готово!

Если у вас Linux, выполните в командной строке такую команду (даже если у вас Qt6, в команде все равно должно быть Qt5):

```
sudo apt install qttools5-dev-tools
```

### 2. Генерация `.ts`-файлов

Для генерации файлов используется `lupdate`. Введите в консоль команду:

```
lupdate <files to translate> -ts <translation files output>
```
Например, в частном случае команда может выглядеть так:

```
lupdate main.cpp mainwindow.h mainwindow.cpp -ts translations/my_app_en.ts translations/my_app_fr.ts
```

### 3. Перевод приложения с помощью Qt Linguist

Откройте Qt Linguist, и с помощью меню *Файл* откройте все файлы перевода
одновременно (так удобнее). Переведите все строки. Не забудьте сохранить
изменения (*Ctrl+S* или соответсвующей кнопкой в меню *Файл*).

Не забывайте отмечать переведенные строки как готовые (галочкой), это
облегчит дальнейшую работу и редактирование переводов.

### 4. Компиляция `.ts`-файлов

Для создания бинарных `.qm`-файлов можно использовать кнопку *Скомпилировать
все* в меню *Файл*. Можно также воспользоваться консольной утилитой
`lrelease`, введя в папке проекта команду:

```
lrelease <.ts files to compile>
```

В нашем примере это

```
lrelease translations/my_app_en.ts translations/my_app_fr.ts
```


Бинарные `.qm`-файлы будут сгенерированы в той же папке и с теми же
названиями, что и `.ts`-файлы.

### 5. Добавление `.qm`-файлов в ресурсы

К `.qm`-файлам приложение должно иметь доступ (в отличие от `.ts`), так что
их обязательно надо добавить в ресурсы. Делается это так же, как и с любыми
другими ресурсами.

### 6. Настройка активации языка

Смотрите пример кода в файле `main_example.cpp`.


### P. S.
А еще все это можно настроить через CMakeLists: [документация](https://doc.qt.io/qt-6/cmake-command-reference.html#cmake-macros-qtlinguisttools).


## Обновление переводов

Если в исходный код приложения добавились новые строки, либо изменились
старые, сгенерировать новые `.ts`-файлы можно той же командой, что
изначально. При этом в консоль (терминал) будет выведена информация о том,
сколько обнаружено новых строк, сколько обнаружено изменившихся старых,
и так далее. В Qt Linguist изменившиееся строки потеряют статус готовых.

Обратите внимание: по умолчанию вызов утилиты lupdate не стирает из `ts`-файла
старые переводы, которые более не используются. Если вы хотите избавиться от
них, вызывайте ее с флагом `-noobsolete`.

## Динамический перевод, перевод даты/времени/валюты

Дополнительная информация здесь: [https://doc.qt.io/qt-6/internationalization.html](https://doc.qt.io/qt-6/internationalization.html)

## Решение конфликтов слияния в Git

К сожалению, конфликты слияния `.ts`-файлов достаточно неприятны, так как
красивых утилит для их исправления нет, а Qt Linguist с такими файлами
работать отказывается. Вам придется открывать эти файлы в текстовом редакторе
и вручную править в них код (они имеют обычный XML-формат, ничего сложного).
